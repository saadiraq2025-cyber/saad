name: 🌐 Build WebView Android App (APK + AAB)

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      id-token: write

    steps:
      - name: 📥 Checkout Repository
        uses: actions/checkout@v4

      - name: ☕ Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ⚙️ Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: 🤖 Setup Android SDK
        uses: android-actions/setup-android@v3
        with:
          api-level: 34
          build-tools: 34.0.0

      - name: 🧱 Create Android WebView App
        run: |
          mkdir -p android/app/src/main/java/com/saadiraq/webview
          mkdir -p android/app/src/main/res/layout
          mkdir -p android/app/src/main/res/values

          # Java MainActivity
          cat <<'EOF' > android/app/src/main/java/com/saadiraq/webview/MainActivity.java
          package com.saadiraq.webview;
          import android.os.Bundle;
          import android.webkit.WebView;
          import android.webkit.WebSettings;
          import androidx.appcompat.app.AppCompatActivity;

          public class MainActivity extends AppCompatActivity {
              @Override
              protected void onCreate(Bundle savedInstanceState) {
                  super.onCreate(savedInstanceState);
                  WebView webView = new WebView(this);
                  setContentView(webView);
                  WebSettings webSettings = webView.getSettings();
                  webSettings.setJavaScriptEnabled(true);
                  webSettings.setDomStorageEnabled(true);
                  webSettings.setLoadWithOverviewMode(true);
                  webSettings.setUseWideViewPort(true);
                  webView.loadUrl("https://saadiraq2025-cyber.github.io/saad/"); // ✅ موقعك
              }
          }
          EOF

          # AndroidManifest.xml
          cat <<'EOF' > android/app/src/main/AndroidManifest.xml
          <manifest xmlns:android="http://schemas.android.com/apk/res/android"
              package="com.saadiraq.webview">
              <uses-permission android:name="android.permission.INTERNET"/>
              <application
                  android:label="Taxi Iraq WebView"
                  android:theme="@style/Theme.AppCompat.Light.NoActionBar">
                  <activity android:name=".MainActivity"
                      android:exported="true">
                      <intent-filter>
                          <action android:name="android.intent.action.MAIN"/>
                          <category android:name="android.intent.category.LAUNCHER"/>
                      </intent-filter>
                  </activity>
              </application>
          </manifest>
          EOF

          echo "✅ Android WebView structure created"

      - name: 🔨 Build Placeholder APK (for HTML projects)
        run: |
          mkdir -p my-apks
          echo "WebView App for saadiraq2025-cyber.github.io/saad/" > my-apks/readme.txt

      - name: 📤 Upload WebView Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: TaxiIraq-WebView
          path: my-apks/
